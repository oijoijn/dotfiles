# config
# prefixキーをC-qに変更
set-option -g prefix C-q

# C-bのキーバインドを解除
unbind C-b
unbind Space

# copymode vi
setw -g mode-keys vi
# 'v' で選択を始める
bind-key -T copy-mode-vi v send -X begin-selection

# =================================================================================
#  SEARCH NAVIGATION (脳負荷ゼロへの道)
# =================================================================================

# 【重要】Prefix + f でウィンドウを検索して移動 (Telescope like)
# tmux 3.2以上で動作する display-popup を使用
# すべてのセッションのすべてのウィンドウをリストアップし、fzfで絞り込み、Enterで移動
bind-key f display-popup -E "\
    tmux list-windows -a -F '#{session_name}:#{window_index} - #{window_name}' \
    | fzf --reverse --header='[Find Window]' --prompt='> ' \
    | sed -E 's/ -.*$//' \
    | xargs -r tmux switch-client -t"

# Prefix + s でセッションを検索して移動 (プロジェクト切り替え)
bind-key s display-popup -E "\
    tmux list-sessions -F '#{session_name}' \
    | fzf --reverse --header='[Switch Session]' --prompt='> ' \
    | xargs -r tmux switch-client -t"

# =================================================================================
#  MINIMALIST STATUS BAR (視覚ノイズの削除)
# =================================================================================

# status ver
set-option -g status-position top

# ステータスライン全体のスタイル
set-option -g status-style "fg=#7aa2f7,bg=default" # 背景を透過または黒に近づける

# 【重要】左側：セッション名だけを表示（ウィンドウリストは消す！）
set-option -g status-left-length 50
set-option -g status-left "#[fg=#1f2335,bg=#7aa2f7,bold] ❐ #S #[default] "

# 【重要】中央：ウィンドウリスト（タブ）を非表示にする
# 検索で移動するため、ここに並べる必要はありません。
# どうしても現在位置を知りたければ '#W' (現在のウィンドウ名) だけ置くのもアリ
set-option -g window-status-format "" 
set-option -g window-status-current-format "#[fg=#7aa2f7,bold] #W "

# 右側：シンプルに
set-option -g status-right-length 60
set-option -g status-right "#[fg=#565f89] %m-%d %H:%M "

# ステータスバーのオン/オフ切り替え (Prefix + b)
# 集中したいときは完全に消す
bind-key b set-option status

# =================================================================================
#  OTHER SETTINGS (元の設定を維持)
# =================================================================================

# neovim color
set-option -g default-terminal "tmux-256color"
set-option -as terminal-features ",*:RGB"

# clipboard
set-option -g set-clipboard on

#マウス操作を有効にする
set-option -g mouse on

# history
set-option -g history-limit 100000

# 新しいウィンドウやペインの作成時にカレントディレクトリを継承
bind-key c new-window -c "#{pane_current_path}"
bind-key % split-window -h -c "#{pane_current_path}"
bind-key '"' split-window -v -c "#{pane_current_path}"
bind-key \\ split-window -h -c "#{pane_current_path}"
bind-key - split-window  -v -c "#{pane_current_path}"

# rename
set-option -g allow-rename off

# vimのキーバインドでペインを移動する
bind-key -r h select-pane -L
bind-key -r j select-pane -D
bind-key -r k select-pane -U
bind-key -r l select-pane -R

# windowの移動（隣へ移動：検索メインなら使用頻度は減るはず）
bind-key -r C-h previous-window
bind-key -r C-l next-window

# リロード
bind-key C-r source-file ~/.tmux.conf \; display "Reloaded!"

# change pane size
bind-key r switch-client -T resize_vi_mode
bind-key -T resize_vi_mode h resize-pane -L 5 \; switch-client -T resize_vi_mode
bind-key -T resize_vi_mode j resize-pane -D 5 \; switch-client -T resize_vi_mode
bind-key -T resize_vi_mode k resize-pane -U 5 \; switch-client -T resize_vi_mode
bind-key -T resize_vi_mode l resize-pane -R 5 \; switch-client -T resize_vi_mode
bind-key -T resize_vi_mode Escape switch-client -T root
bind-key -T resize_vi_mode q switch-client -T root

# ペイン最大化
bind-key -n C-z resize-pane -Z
